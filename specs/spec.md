# Spec.md：老虎消防车 App

---

## 0. 需求变更历史

| 版本 | 日期 | 变更类型 | 变更内容 | 影响范围 |
|------|------|---------|---------|---------|
| v1.0 | 2025-01-15 | 初始版本 | 完成首轮需求访谈，输出完整 spec 文档 | 全部 |
| ^ | ^ | 新增 | IP 角色设定：小火（老虎消防员）完整人设 | 1.2 |
| ^ | ^ | 新增 | 徽章收集系统：7 枚徽章 + 变体规则 + 集齐奖励 | 2.1.6, 2.2 |
| ^ | ^ | 新增 | 家长模式：时间控制、使用统计、进度管理 | 2.1.7 |
| ^ | ^ | 新增 | 我的收藏功能：徽章展示页面 | 2.1.6 |
| ^ | ^ | 新增 | 音效系统设计：BGM + 场景差异化音效 + 语音规范 | 3.4 |
| ^ | ^ | 新增 | 边缘场景处理：无操作提示、防疯狂点击 | 2.4 |
| ^ | ^ | 新增 | 视频制作规格：7 个视频清单 + 制作规格 + 脚本示例 | 7 |
| ^ | ^ | 更新 | 技术栈状态模型：新增 Badge 和 totalPlayTime | 5.1 |
| ^ | ^ | 更新 | 验收标准：新增收集系统、家长模式、交互体验验收项 | 6.1 |

---

---

## 0.1 项目规范与 AI 协作声明

本项目在需求分析、方案设计、技术实现及后续迭代过程中，统一遵循项目根目录中的 **《CLAUDE.md》** 与 **《constitution.md》**，作为 AI 协作方式、架构约束、代码规范及行为准则的最高约束文件。

在出现规则或决策冲突时，优先级顺序如下：

1. constitution.md
2. CLAUDE.md
3. 本 spec 文档
4. 即时补充说明或讨论结论

---


## 1. 需求概述

### 1.1 背景与目标

本项目面向 **3–6 岁学龄前儿童**，打造一款以"小火"（老虎消防员）IP为核心的消防安全启蒙教育原生应用。通过高度简化、强引导性、高反馈感的互动流程，结合故事化闯关与趣味动画，帮助低龄儿童建立基础火灾认知、设备识别与求助意识。目标是实现"一看就懂、一点就会、一玩就记"的安全教育体验。

### 1.2 IP 角色设定：小火

| 属性 | 设定 |
|------|------|
| **形象** | 一只开消防车的老虎卡通角色，全动画呈现 |
| **名字** | 小火 |
| **性格** | 小孩子调皮风格，像小朋友的朋友 |
| **说话风格** | 正常语速，带停顿；鼓励型回复（如"再靠近一点点哦！""你记得真牢！"） |
| **出现方式** | 关键时刻弹出（如通关、提示、庆祝） |
| **呈现形式** | 全动画角色，2D 扁平风格 |

### 1.3 用户画像

| 用户类型 | 描述 |
|---------|------|
| **核心用户** | 3–6 岁儿童（无文字阅读能力，依赖语音+图像理解） |
| **辅助用户** | 家长/幼教老师（关注内容安全性、教育价值、使用时长管控） |
| **使用场景** | 家庭亲子共玩、幼儿园安全课辅助、碎片化娱乐学习 |
| **行为特征** | 手指操作精度低、注意力集中时间 ≤5 分钟、偏好重复性正向反馈 |

### 1.4 核心价值

> 用 **超大触控区域 + 即时音画反馈 + 简单手势 + 收集激励机制** 构建零门槛交互，让 3–6 岁儿童在"玩消防车"的过程中，自然习得"着火要报警""消防车能灭火""听指挥快撤离"等关键安全意识，并通过徽章收集系统增强重复游玩价值。

---

## 2. 功能需求

### 2.1 核心功能列表

#### 1. 启动页（欢迎场景 - 动画）

- App 启动 → 自动播放 ** 动画**：小火的消防车从底部驶入（含鸣笛音效 + 轻快活泼背景音乐）
- 动画结束 → 小火探头挥手 + **语音播报**："HI！今天和我一起救火吧！"（正常语速带停顿）
- **任意点击屏幕** → 进入主地图（无按钮，全屏可点）
- **首次使用**：直接进入启动页，默认使用时长设置 15 分钟

#### 2. 主地图场景（主页面）

- 背景为卡通世界地图，显示以下元素：
  - **3 个超大场景图标**（直径 ≥120pt）：消防站（红色）、学校（蓝色）、森林（绿色）
  - **右上角齿轮图标**（半透明，不抢眼）：家长模式入口
  - **"我的收藏"按钮**（左上角，小火头像图标）

- 场景图标状态：
  | 状态 | 视觉效果 | 音效 |
  |------|---------|------|
  | **锁定态** | 灰色半透明 + 锁图标 + 轻微抖动 | 无 |
  | **可点击态** | 彩色 + 呼吸光效 | 每 5 秒播放"叮咚"提示音 |

- 点击已解锁图标 → 播放 **Lottie 转场动画**（消防车驶向目标）→ 进入对应场景

#### 3. 消防站场景（教学互动）

- 展示静态消防站画面，含 **4 个超大可点击设备**（消防栓、云梯、灭火器、水枪），每个区域 ≥100×100pt
- 点击任一设备 → 播放 **MP4 教学视频**（15 秒内）
- 视频结束后自动返回场景，设备图标变为 **"星星点亮"状态**（金色闪烁动画）→ **弹出 1 枚徽章** → **收集成功提示音**
- 完成全部 4 个设备 → 自动播放 **成功音效 + 小火欢呼语音** → 解锁"学校"场景

#### 4. 学校场景（剧情动画）

- 进入后自动触发 **警报音效 + 屏幕边缘红光闪烁**（柔和脉冲，非刺眼）
- 小火语音提示："学校着火啦！快叫消防车！"
- 自动播放 **MP4 叙事动画**（45 秒内）：展示"小朋友发现火 → 打 119 → 消防车到达 → 喷水灭火 → 老师带大家排队离开"
- 动画结束 → 弹出 **小火点赞动画（Lottie）** + 语音："你真棒！记住，着火要找大人帮忙！" → **弹出 1 枚徽章** → 解锁"森林"场景

#### 5. 森林场景（手势交互救援）

- 进入后显示森林火灾画面，小火语音提示："小羊被困啦！快开直升机救它们！"
- 屏幕中央显示 **直升机图标（超大，≥150pt）**，点击后起飞
- 用户通过 **单指拖拽** 控制直升机移动（移动速度缓慢，降低操作难度）
- 当直升机靠近小羊（距离 ≤80pt）→ 自动吸附 + 显示 **"放下梯子"按钮（圆形，≥100pt）**
- 点击按钮 → 播放 **MP4 救援片段**（小羊爬上梯子，直升机飞走）→ **弹出 1 枚徽章**
- 成功救出两只小羊 → 播放 **庆祝 Lottie 动画 + 语音总结**："直升机能从天上救人，真厉害！"

#### 6. 我的收藏（徽章收集展示）

- 点击主地图左上角小火头像 → 进入"我的收藏"页面
- 展示已获得的徽章，按场景分组：
  - 消防站：最多 4 枚（每学完 1 个设备获得 1 枚）
  - 学校：1 枚（看完动画获得）
  - 森林：最多 2 枚（每救 1 只小羊获得 1 枚）
- 徽章变体系统：同一场景重复通关可获得不同颜色变体（如红色、黄色、蓝色版本）
- 集齐所有徽章（7 枚）→ 解锁 **隐藏彩蛋动画**（小火跳舞 + 放烟花庆祝）

#### 7. 家长模式（管控与统计）

##### 7.1 入口与验证

- **入口位置**：主地图右上角齿轮图标 ⚙️（半透明，不抢眼）
- **验证方式**：数学题验证（如 "5 + 3 = ?"，6 岁以下儿童大概率不会）

##### 7.2 时间控制

| 设置项 | 选项 |
|-------|------|
| 每次使用时长 | 5 分钟 / 10 分钟 / **15 分钟（默认）** / 30 分钟 |
| 提前提醒 | 提前 ☑ 2 分钟 |

##### 7.3 时间到处理流程

```
┌─────────────────────────────────────────────────────────┐
│ 1. 小火弹出语音："时间到啦！我们明天再玩吧！"           │
│ 2. 屏幕显示家长验证界面："输入数学题继续"               │
│    ├─ 答对 → 显示"再玩 5 分钟"按钮                     │
│    └─ 取消 → App 退出到桌面                            │
└─────────────────────────────────────────────────────────┘
```

##### 7.4 使用统计

- 图表展示：本周每日使用时长柱状图
- 示例：
```
    本周使用时长
    ┌─────────────────────────────────┐
    │ ▁▃▄▂▁█▅                         │
    │ 一二三四五六日                   │
    │ 总计：1小时23分钟                │
    └─────────────────────────────────┘
```

##### 7.5 进度管理

- **重置进度按钮**：清空所有场景进度和徽章收藏，重新开始
- 确认弹窗："确定要重置所有进度吗？此操作不可撤销。"

### 2.2 收集系统详细设计

| 场景 | 获得条件 | 徽章数量 | 变体规则 |
|------|---------|---------|---------|
| 消防站 | 每学完 1 个设备 | 4 枚 | 重复通关获得不同颜色（红/黄/蓝/绿） |
| 学校 | 看完动画 | 1 枚 | 重复观看获得不同边框颜色 |
| 森林 | 每救 1 只小羊 | 2 枚 | 重复通关获得不同小羊表情 |

**集齐奖励**：集齐 7 枚徽章 → 解锁隐藏彩蛋动画（小火跳舞 + 放烟花）

### 2.3 功能优先级

| 功能模块 | 优先级 | 说明 |
|---------|--------|------|
| 启动页（Lottie + 全屏点击） | P0 | 首印象关键 |
| 主地图图标状态管理与转场 | P0 | 导航核心 |
| 消防站设备点击 + MP4 教学 | P0 | 核心知识输入 |
| 学校场景 MP4 剧情动画 | P0 | 安全流程建立 |
| 森林场景简化手势救援 | P1 | 提升参与感，操作需极度简化 |
| 场景解锁逻辑 | P0 | 游戏化进度控制 |
| 全局语音引导（小火） | P0 | 替代文字，适配 3–6 岁 |
| 徽章收集系统 | P1 | 增加重复游玩价值 |
| 家长模式（时间控制） | P1 | 家长管控需求 |
| 我的收藏展示 | P2 | 收集系统配套 |
| 使用统计图表 | P2 | 家长反馈功能 |

### 2.4 边界条件与异常处理

| 场景 | 处理方式 |
|------|---------|
| **误触防护** | 所有点击区域 ≥100pt；相邻元素间距 ≥40pt |
| **重复触发** | 同一设备/动画播放中，屏蔽额外点击（图标变灰） |
| **手势容错** | 森林场景直升机移动采用"慢速跟随"，避免因手抖失控 |
| **中断恢复** | 切后台后返回，当前 MP4 视频从头播放（确保知识完整接收） |
| **资源缺失** | 若 Lottie/MP4 加载失败，降级为静态图 + 语音描述 |
| **无操作 30 秒** | 小火弹出："需要帮忙吗？" + 轻轻晃动提示可点击的元素 |
| **连续 3 次快速点击** | 小火语音："慢慢来，不着急~"（防疯狂点击） |
| **进度保存** | 可由家长在家长模式中重置进度 |

---

## 3. 非功能需求

### 3.1 性能指标

- 冷启动时间 ≤1.2 秒（中端 Android / iPhone SE）
- Lottie 动画帧率 ≥30 FPS；MP4 视频硬解播放无卡顿
- 单场景内存占用 ≤120 MB
- 安装包体积 ≤300 MB（含所有本地资源）

### 3.2 兼容性要求

- **平台**：Android 8.0+ (API 26) / iOS 13+
- **屏幕**：适配最小 4.7 英寸（320×568 pt）至 12.9 英寸 iPad
- **输入**：仅支持单点触控（忽略多指操作）

### 3.3 安全性要求

- **零网络权限**：完全离线运行
- **无数据收集**：不访问位置、通讯录、相册等任何敏感权限
- **内容安全**：所有 MP4/Lottie 资源内置，禁止动态加载外部内容
- **符合 COPPA & GDPR-K**：无广告、无内购、无社交功能

### 3.4 音效系统设计

| 音效类型 | 风格/场景 |
|---------|----------|
| **背景音乐** | 启动页/主地图：轻快活泼（像卡通片开场） |
| **点击音效** | 消防站："咔"、学校："哔"、森林："呼"（场景差异化） |
| **语音语速** | 正常语速，带停顿（适配 3–6 岁理解能力） |
| **成功音效** | "叮！" + 小火欢呼语音 |
| **提示音效** | 柔和"叮咚"（可点击提示） |

---

## 4. 交互与体验要求（UE 专项）

### 4.1 核心页面交互逻辑（UE 原则）

- **Fitts 定律强化**：所有交互元素尺寸 ≥100pt，边缘留白充足
- **即时反馈三要素**：
  1. **视觉**：点击即缩放 90% → 恢复 + 高亮色
  2. **听觉**：场景专属音效
  3. **动效**：Lottie 微交互动画（如设备被点后"跳一下"）
- **语音主导**：所有关键信息由小火语音传达，文字仅作辅助（字号 ≥24pt，圆体）
- **节奏控制**：每个场景核心操作 ≤3 步；单次停留建议时长 ≤3 分钟

### 4.2 错误提示规范（儿童友好）

- **无错误概念**：不出现"错误""失败"等负面词汇
- **引导式重试**：
  - 森林场景未对准小羊 → 小火语音："再靠近一点点哦！" + 小羊眨眼动画
  - 重复点击已学设备 → 播放简短鼓励语："你记得真牢！"
- **加载状态**：显示小火打盹 Lottie 动画 + 轻柔呼吸音，避免焦虑

---

## 5. 开发与测试约束

### 5.1 技术栈适配建议（Kotlin Multiplatform 原生方案）

- **跨平台框架**：**Kotlin Multiplatform Mobile (KMM)**
  - 共享逻辑层（场景状态、资源路径、解锁规则、徽章收集）用 Kotlin 编写
  - 平台特定 UI：Android 使用 Jetpack Compose；iOS 使用 SwiftUI
- **动画方案**：
  - **Lottie**：用于启动页、转场、微交互（通过 `lottie-compose` / `Lottie-iOS`）
  - **MP4**：用于教学/剧情视频，预置 `assets/videos/` 目录，通过平台原生 VideoPlayer 播放
- **资源管理**：
  - 所有 Lottie JSON 和 MP4 文件按场景分目录（如 `/welcome`, `/firestation`）
  - 共享层提供 `ResourcePathProvider` 接口，各平台实现本地路径映射
- **状态模型（Kotlin Shared）**：

  ```kotlin
  enum class SceneStatus { LOCKED, UNLOCKED, COMPLETED }

  data class Badge(
      val id: String,
      val scene: SceneType,
      val variant: Int = 0  // 0=默认, 1=红色变体, 2=黄色变体...
  )

  data class GameProgress(
      val fireStation: SceneStatus = SceneStatus.UNLOCKED,
      val school: SceneStatus = SceneStatus.LOCKED,
      val forest: SceneStatus = SceneStatus.LOCKED,
      val badges: List<Badge> = emptyList(),
      val totalPlayTime: Long = 0L  // 毫秒
  )
  ```

- **Coding Agent 友好**：每个场景拆分为独立 KMM 模块（`feature-welcome`, `feature-map`, `feature-firestation`, `feature-collection`, `feature-parent`），接口清晰

### 5.2 测试用例设计要点

- **可用性测试**：
  - 3–4 岁儿童能否在无指导情况下完成消防站首设备点击？
  - 5 岁儿童能否独立完成森林救援（拖拽+点击）？
- **兼容性测试**：
  - 在 Android 8.0 低端机（1GB RAM）验证 MP4 播放流畅度
  - 在 iPhone 8 验证 Lottie 动画无掉帧
- **回归测试**：
  - 修改解锁逻辑后，验证主地图图标状态同步正确
  - 更换 MP4 资源后，验证播放器自动适配分辨率
  - 徽章收集逻辑验证：重复通关应获得变体版本

---

## 6. 验收标准

### 6.1 功能验收条件

**核心流程：**
- [ ] 启动页 Lottie 动画在 3-5 秒内完成，全屏任意点击进入主地图
- [ ] 主地图三个图标尺寸 ≥120pt，锁定态有明显视觉区分
- [ ] 消防站四个设备点击区域 ≥100×100pt，点击后播放对应 MP4 视频
- [ ] 完成消防站全部学习后，学校图标自动变为可点击态（有光效+提示音）
- [ ] 学校 MP4 动画播放完毕后，森林图标解锁
- [ ] 森林场景支持单指拖拽直升机，靠近小羊自动吸附并显示"放下梯子"按钮（≥100pt）

**收集系统：**
- [ ] 消防站每学完 1 个设备获得 1 枚徽章，并在"我的收藏"中显示
- [ ] 学校场景看完动画获得 1 枚徽章
- [ ] 森林场景每救 1 只小羊获得 1 枚徽章
- [ ] 重复通关可获得徽章变体（不同颜色版本）
- [ ] 集齐 7 枚徽章后解锁隐藏彩蛋动画

**家长模式：**
- [ ] 主地图右上角显示半透明齿轮图标
- [ ] 点击齿轮图标进入数学题验证界面
- [ ] 家长可设置使用时长（5/10/15/30 分钟），默认 15 分钟
- [ ] 时间到前 2 分钟弹出提醒
- [ ] 时间到后显示家长验证界面，验证通过可选择"再玩 5 分钟"
- [ ] 家长模式中显示本周使用时长柱状图
- [ ] 家长模式中提供"重置进度"按钮

**交互体验：**
- [ ] 所有关键步骤均有小火语音引导（正常语速带停顿）
- [ ] 不同场景点击音效差异化（消防站"咔"、学校"哔"、森林"呼"）
- [ ] 无操作 30 秒后小火弹出提示："需要帮忙吗？"
- [ ] 连续 3 次快速点击同一按钮，小火语音提示："慢慢来，不着急~"

### 6.2 非功能验收条件

- [ ] 在 Samsung J2 Core (Android 8.1, 1GB RAM) 上启动时间 ≤1.5 秒
- [ ] 在 iPhone 8 上 Lottie 动画平均帧率 ≥28 FPS
- [ ] 安装包体积 ≤70 MB（Google Play / App Store 实测）
- [ ] 通过 Apple Kids Category 与 Google Family Safety 审核（无网络、无追踪、无广告）
- [ ] UE 设计稿符合：所有交互元素 ≥100pt，色彩对比度 ≥4.5:1（WCAG AA）

---

## 7. 视频制作规格

### 7.1 视频清单

| 场景 | 类型 | 时长 | 内容大纲 |
|------|-----|------|---------|
| 消防站-灭火器 | 教学视频 | 15秒 | 展示灭火器外观 → 演示拔保险销 → 喷射灭火 → 小火点赞总结 |
| 消防站-消防栓 | 教学视频 | 15秒 | 展示消防栓 → 连接水带 → 打开水阀门 → 喷水演示 |
| 消防站-云梯 | 教学视频 | 15秒 | 展示云梯伸展 → 消防员登高 → 救援演示 |
| 消防站-水枪 | 教学视频 | 15秒 | 展示水枪 → 握持姿势 → 喷水控制 |
| 学校 | 剧情动画 | 45秒 | 小朋友发现火 → 打 119 → 消防车到达 → 喷水灭火 → 排队撤离 |
| 森林-救小羊 | 救援片段 | 10秒×2 | 小羊爬上梯子 → 直升机飞离（每只小羊一段） |
| 隐藏彩蛋 | 庆祝动画 | 20秒 | 小火跳舞 → 放烟花庆祝 |

### 7.2 制作规格

| 属性 | 规格 |
|------|------|
| **动画风格** | 2D 扁平动画 |
| **分辨率** | 1920×1080 (16:9) 横屏为主，兼容竖屏裁切 |
| **角色** | 小火（老虎消防员），全动画呈现 |
| **配音** | 小火语音（正常语速，带停顿，鼓励型风格） |
| **制作方** | 外部动画工作室 |
| **交付格式** | MP4 (H.264) + 音频分轨 |

### 7.3 视频脚本大纲示例

**《灭火器》教学视频 - 15秒**
```
[0-3秒]   中景：消防站内景，小火站在灭火器旁边
          小火（指着）："这是灭火器！"

[3-8秒]   特写：灭火器放大展示，罐体红色圆润
          画外音："它红红胖胖的，里面装着神奇的水"

[8-12秒]  动作：小火拔掉保险销，对准小火苗喷射
          音效："嗤——"（喷射声）
          画面：火焰缩小 → 熄灭

[12-15秒] 小火（竖大拇指）："记住哦，小火用它就能搞定！"
          音效："叮！"（成功提示音）
```

---

> ✅ 本 Spec 已针对 **3–6 岁儿童认知特点** 优化交互密度与反馈强度，明确 **Kotlin Multiplatform + Lottie/MP4 混合动画** 技术路径，嵌入 **UE 设计原则**，补充 **徽章收集系统** 与 **家长管控功能**，可直接交付 UI/UE 团队进行高保真原型设计，并同步外部动画工作室进行视频制作。
