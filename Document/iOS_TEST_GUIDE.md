# TigerFire iOS 平台手动测试指南

## 📱 测试目标

通过手动测试验证iOS平台的应用功能是否正常工作，确保：
- ✅ 应用可以正常编译和运行
- ✅ 页面导航流程正常
- ✅ 徽章收集功能正确
- ✅ 视频播放流畅
- ✅ UI响应灵敏
- ✅ 无崩溃和严重bug

---

## 🛠️ 测试环境准备

### 设备要求
- **真机**: iPhone 8 或以上（iOS 14.0+）
- **模拟器**: iPhone 14 Pro 或以上模拟器（iOS 14.0+）

### 开发工具
- **Xcode**: 14.0 或以上版本
- **CocoaPods**: 已安装（如需依赖管理）

### 编译项目

#### 方法1: 使用 Xcode（推荐）

```bash
# 1. 打开 Xcode 项目
cd /Users/vsh9p8q/Personal/Project/TigerTruck/TigerFire
open iosApp/iosApp.xcodeproj

# 2. 在 Xcode 中选择目标设备或模拟器
# 3. 点击运行按钮 (⌘+R) 编译并运行
```

#### 方法2: 使用命令行

```bash
# 列出可用的 scheme
xcodebuild -list -project iosApp/iosApp.xcodeproj

# 编译项目
xcodebuild -project iosApp/iosApp.xcodeproj \
  -scheme TigerFire \
  -configuration Debug \
  -sdk iphoneos \
  -destination 'platform=iOS Simulator,name=iPhone 15' \
  build
```

### 常见编译问题

| 问题 | 解决方案 |
|------|----------|
| KMM 模块找不到 | 确保先运行 `./gradlew linkDebugFrameworkIosX64` |
| 证书问题 | 在 Xcode 中配置开发者账号和签名证书 |
| 模拟器启动失败 | 重启模拟器或使用不同模拟器设备 |

---

## 🧪 功能测试清单

### 1. 应用启动测试

**测试步骤:**
1. [ ] 在 Xcode 中选择目标设备/模拟器
2. [ ] 点击运行按钮启动应用
3. [ ] 观察欢迎页面动画

**预期结果:**
- ✅ 应用成功启动，无崩溃
- ✅ 欢迎页面显示消防车入场动画（2-3秒）
- ✅ 卡车动画完成后切换到小火挥手动画
- ✅ 语音播放（如果已实现）
- ✅ 自动导航到主地图页面

**验证点:**
```
□ 应用启动时间 < 5秒
□ 动画播放流畅（≥30fps）
□ 页面无布局错误
□ 无控制台错误日志
```

---

### 2. 主地图页面测试

**测试步骤:**
1. [ ] 从欢迎页自动导航到主地图
2. [ ] 观察3个场景图标显示
3. [ ] 检查左上角"我的收藏"按钮
4. [ ] 检查右上角"家长模式"按钮

**预期结果:**
- ✅ 3个场景图标正确显示：消防站（红色）、学校（蓝色）、森林（绿色）
- ✅ 消防站默认解锁（可点击）
- ✅ 学校和森林默认锁定（灰色+锁图标）
- ✅ 左上角星形按钮（我的收藏）可点击
- ✅ 右上角齿轮按钮（家长模式）可点击

**场景解锁状态验证:**
```
场景      | 初始状态 | 完成消防站后 | 完成学校后
---------|---------|-------------|----------
消防站    | 解锁    | 完成        | 完成
学校      | 锁定    | 解锁        | 完成
森林      | 锁定    | 锁定        | 解锁
```

---

### 3. 消防站场景测试

**测试步骤:**
1. [ ] 从主地图点击"消防站"图标
2. [ ] 进入消防站场景页面
3. [ ] 观察设备布局（2x2网格）
4. [ ] 依次点击4个设备观看视频

**设备清单:**
| 设备 | 图标 | 视频文件 | 测试 |
|------|------|----------|------|
| 灭火器 | 灭火器图标 | firestation_extinguisher.mp4 | [ ] |
| 消防栓 | 水滴图标 | firestation_hydrant.mp4 | [ ] |
| 云梯   | 梯子图标 | firestation_ladder.mp4 | [ ] |
| 水枪   | 救生圈图标 | firestation_hose.mp4 | [ ] |

**预期结果:**
- ✅ 4个设备图标正确显示
- ✅ 点击设备后视频播放器覆盖全屏
- ✅ 视频播放流畅（≥30fps）
- ✅ 视频播放完成后显示徽章奖励动画
- ✅ 已完成的设备显示黄色星标
- ✅ 返回按钮（左上角）正常工作

**徽章收集验证:**
```
□ 首次观看获得 v0 变体（黄色）
□ 重复观看获得 v1/v2/v3 变体（红/蓝/绿）
□ 徽章显示在收藏页面
```

---

### 4. 学校场景测试

**测试步骤:**
1. [ ] 完成消防站所有设备
2. [ ] 从主地图点击"学校"图标
3. [ ] 观察学校场景页面
4. [ ] 点击播放按钮观看动画

**预期结果:**
- ✅ 学校场景解锁后可点击
- ✅ 进入场景后显示播放按钮（超大尺寸≥180dp）
- ✅ 播放按钮有脉冲动画吸引注意
- ✅ 点击后播放45秒学校叙事动画
- ✅ 视频播放完成后获得"学校"徽章
- ✅ 观看完后森林场景解锁

**警报效果验证（安全性优化）:**
```
□ 红色警报闪烁柔和（透明度降低40%）
□ 闪烁速度减慢（3秒周期而非2秒）
□ 不刺眼，儿童不会被惊吓
```

---

### 5. 森林场景测试

**测试步骤:**
1. [ ] 完成学校场景
2. [ ] 从主地图点击"森林"图标
3. [ ] 观察2只待救小羊
4. [ ] 拖动直升机救援小羊

**预期结果:**
- ✅ 森林场景解锁后可点击
- ✅ 2只小羊显示求救摇晃动画
- ✅ 小羊周围显示卡通火焰（emoji 🔥）
- ✅ 小羊尺寸≥110dp（易于点击）
- ✅ 拖动直升机到小羊上方触发救援
- ✅ 救援动画播放（10秒）
- ✅ 每救援1只小羊获得1个徽章
- ✅ 救援完2只小羊后场景完成

**火焰效果验证（安全性优化）:**
```
□ 火焰为可爱的 emoji 🔥（非粒子效果）
□ 火焰有跳跃和摇摆动画
□ 效果有趣不恐怖
```

---

### 6. 我的收藏（徽章展示）测试

**测试步骤:**
1. [ ] 从主地图点击左上角星形按钮
2. [ ] 进入收藏页面
3. [ ] 观察徽章分组展示
4. [ ] 验证已获得的徽章数量

**预期结果:**
- ✅ 收藏页面显示"我的收藏"标题
- ✅ 显示已收集徽章数量（X / 7）
- ✅ 按场景分组展示：
  - 消防站：4个槽位
  - 学校：1个槽位
  - 森林：2个槽位
- ✅ 已获得徽章显示完整图标+变体颜色
- ✅ 未获得徽章显示灰色轮廓+"??"
- ✅ 徽章卡片有浮动动画效果
- ✅ 集齐7枚徽章后播放彩蛋动画

**徽章变体颜色验证:**
```
变体 | 颜色    | 获取条件
-----|---------|----------
v0   | 黄色    | 首次观看
v1   | 红色    | 第2次观看
v2   | 蓝色    | 第3次观看
v3   | 绿色    | 第4次观看
```

---

### 7. 家长模式测试

**测试步骤:**
1. [ ] 从主地图点击右上角齿轮按钮
2. [ ] 进入家长模式验证页面
3. [ ] 完成数学验证题
4. [ ] 进入家长控制面板

**预期结果:**
- ✅ 显示数学验证题（防止儿童误入）
- ✅ 答对后进入家长控制面板
- ✅ 可设置使用时长限制（5/10/15/30分钟）
- ✅ 可查看使用统计数据
- ✅ 可重置游戏进度
- ✅ 退出按钮返回主地图

---

## 🔄 导航测试

### 页面跳转流程

**正向导航:**
1. [ ] Welcome → Map（自动）
2. [ ] Map → FireStation
3. [ ] Map → School（解锁后）
4. [ ] Map → Forest（解锁后）
5. [ ] Map → Collection
6. [ ] Map → Parent

**返回导航:**
1. [ ] FireStation → Map（左上角返回按钮）
2. [ ] School → Map
3. [ ] Forest → Map
4. [ ] Collection → Map
5. [ ] Parent → Map

**预期结果:**
- ✅ 所有页面跳转流畅，无卡顿
- ✅ 返回按钮正常工作
- ✅ 无意外导航到错误页面
- ✅ 状态正确保存（返回后进度不丢失）

---

## 📊 性能验证

### 启动性能
```bash
# 在 Xcode 中查看启动时间
Debug Navigator → Performance → Launch Time
```
| 指标 | 目标 | 实际 | 通过 |
|------|------|------|------|
| 冷启动 | ≤5秒 | ___ | [ ] |
| 热启动 | ≤2秒 | ___ | [ ] |

### 内存占用
```bash
# 在 Xcode 中查看内存使用
Debug Navigator → Memory
```
| 指标 | 目标 | 实际 | 通过 |
|------|------|------|------|
| 启动后 | ≤150MB | ___ | [ ] |
| 单场景 | ≤120MB | ___ | [ ] |
| 长时间使用 | ≤200MB | ___ | [ ] |

### 帧率测试
```bash
# 在 Xcode 中查看帧率
Debug Navigator → FPS
```
| 场景 | 目标 | 实际 | 通过 |
|------|------|------|------|
| 欢迎动画 | ≥30fps | ___ | [ ] |
| 地图滚动 | ≥60fps | ___ | [ ] |
| 视频播放 | ≥30fps | ___ | [ ] |
| 徽章浮动 | ≥60fps | ___ | [ ] |

---

## 🐛 已知问题和注意事项

### 当前限制
1. **音频功能**: 部分音频播放功能未完成（标记为 TODO）
2. **Lottie动画**: 需要确保 Lottie JSON 文件已添加到项目
3. **视频资源**: 需要 MP4 视频文件在 assets 中

### 代码警告（非阻塞）
- ViewModel deprecated warning
- expect/actual classes Beta warning

### 测试提示
- 测试前确保所有资源文件已正确添加
- 使用模拟器测试时性能可能与真机有差异
- 建议在真机上测试视频播放性能

---

## ✅ 测试完成标准

**通过条件:**
- ✅ 应用可以正常编译和运行
- ✅ 所有页面导航正常
- ✅ 至少完成1个设备的徽章收集
- ✅ 视频播放流畅无卡顿
- ✅ 无崩溃和严重bug
- ✅ 返回按钮正常工作

**性能要求:**
- ✅ 启动时间 ≤5秒
- ✅ 帧率 ≥30fps
- ✅ 内存占用 ≤200MB

---

## 📝 测试报告模板

```markdown
# iOS 平台测试报告

**测试日期**: ______
**测试设备**: ______ (iPhone型号或模拟器)
**iOS版本**: ______
**Xcode版本**: ______

## 测试结果总结

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 应用启动 | ✅/❌ | |
| 主地图 | ✅/❌ | |
| 消防站 | ✅/❌ | |
| 学校 | ✅/❌ | |
| 森林 | ✅/❌ | |
| 我的收藏 | ✅/❌ | |
| 家长模式 | ✅/❌ | |
| 导航流程 | ✅/❌ | |

## 性能数据

- 启动时间: ___ 秒
- 内存占用: ___ MB
- 平均帧率: ___ fps

## 发现的问题

1.
2.
3.

## 总体评价

- ✅/❌ 建议发布
- ✅/❌ 需要修复

**测试人员**: ______
```

---

## 🚀 快速测试命令

```bash
# 清理构建
cd /Users/vsh9p8q/Personal/Project/TigerTruck/TigerFire
rm -rf iosApp/iosApp/DerivedData

# 重新构建 KMM 框架
./gradlew linkDebugFrameworkIosX64

# 在 Xcode 中打开项目
open iosApp/iosApp.xcodeproj

# 查看实时日志（在运行时）
# 在 Xcode 中: View → Debug Area → Activate Console
```

---

## 📞 相关资源

- **项目结构**: `CLAUDE.md`
- **功能规格**: `specs/spec.md`
- **Android测试**: `document/UI_AUTOMATION_TEST_GUIDE.md`
- **E2E测试**: `document/E2E_TEST_GUIDE.md`

---

**文档维护**: TigerFire 开发团队
**最后更新**: 2026-02-03
