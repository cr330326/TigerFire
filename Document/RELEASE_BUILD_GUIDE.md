# TigerFire Android Release æ„å»ºæŒ‡å—

## ğŸ“‹ æ„å»ºæµç¨‹æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å®‰è£…ä¾èµ–å·¥å…·                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ç”Ÿæˆç­¾å Keystore                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. é…ç½®ç­¾åæ–‡ä»¶                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. (å¯é€‰) å‹ç¼©è§†é¢‘èµ„æº                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. æ„å»º Release APK                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ­¥éª¤ 1: å®‰è£…ä¾èµ–å·¥å…·

### macOS
```bash
# å®‰è£… FFmpeg (ç”¨äºè§†é¢‘å‹ç¼©)
brew install ffmpeg

# å®‰è£… bc (ç”¨äºè®¡ç®—)
brew install bc

# éªŒè¯å®‰è£…
ffmpeg -version
```

### Ubuntu/Debian
```bash
sudo apt update
sudo apt install ffmpeg bc
```

### Windows
- ä» [FFmpeg å®˜ç½‘](https://ffmpeg.org/download.html) ä¸‹è½½
- è§£å‹å¹¶æ·»åŠ åˆ°ç³»ç»Ÿ PATH

---

## æ­¥éª¤ 2: ç”Ÿæˆç­¾å Keystore

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /Users/vsh9p8q/Personal/Project/TigerTruck/TigerFire

# ç”Ÿæˆ Keystore
keytool -genkey -v -keystore release.keystore \
  -alias release -keyalg RSA -keysize 2048 -validity 10000
```

### è¾“å…¥ç¤ºä¾‹
```
è¾“å…¥å¯†é’¥åº“å£ä»¤: ****** (è®°ä½è¿™ä¸ªå¯†ç )
å†æ¬¡è¾“å…¥æ–°å£ä»¤: ******

æ‚¨çš„åå­—ä¸å§“æ°æ˜¯ä»€ä¹ˆ?
  [Unknown]:  Tiger Fire

æ‚¨çš„ç»„ç»‡å•ä½åç§°æ˜¯ä»€ä¹ˆ?
  [Unknown]:  Development

æ‚¨çš„ç»„ç»‡åç§°æ˜¯ä»€ä¹ˆ?
  [Unknown]:  TigerTruck

æ‚¨æ‰€åœ¨çš„åŸå¸‚æˆ–åŒºåŸŸåç§°æ˜¯ä»€ä¹ˆ?
  [Unknown]:  Beijing

æ‚¨æ‰€åœ¨çš„çœ/å¸‚/è‡ªæ²»åŒºåç§°æ˜¯ä»€ä¹ˆ?
  [Unknown]:  Beijing

è¯¥å•ä½çš„åŒå­—æ¯å›½å®¶/åœ°åŒºä»£ç æ˜¯ä»€ä¹ˆ?
  [Unknown]:  CN

CN=Tiger Fire, OU=Development, O=TigerTruck, L=Beijing, ST=Beijing, C=CNæ˜¯å¦æ­£ç¡®?
  [å¦]:  æ˜¯

è¾“å…¥ <release> çš„å¯†é’¥å£ä»¤
        (å¦‚æœå’Œå¯†é’¥åº“å£ä»¤ç›¸åŒ, æŒ‰å›è½¦): (ç›´æ¥å›è½¦)
```

---

## æ­¥éª¤ 3: é…ç½®ç­¾åæ–‡ä»¶

```bash
# å¤åˆ¶æ¨¡æ¿
cp keystore.properties.example keystore.properties

# ç¼–è¾‘æ–‡ä»¶ï¼Œå¡«å…¥åˆšæ‰è®¾ç½®çš„å¯†ç 
nano keystore.properties
```

### keystore.properties å†…å®¹
```properties
storeFile=release.keystore
storePassword=åˆšæ‰è®¾ç½®çš„å¯†é’¥åº“å£ä»¤
keyAlias=release
keyPassword=åˆšæ‰è®¾ç½®çš„å¯†é’¥å£ä»¤(æˆ–ä¸åº“å¯†ç ç›¸åŒ)
```

**âš ï¸ é‡è¦**: `keystore.properties` å’Œ `release.keystore` ä¸è¦æäº¤åˆ° Gitï¼

---

## æ­¥éª¤ 4: å‹ç¼©è§†é¢‘èµ„æº (å¯é€‰ï¼Œæ¨è)

è§†é¢‘å ç”¨çº¦ 107MBï¼Œå‹ç¼©åå¯èŠ‚çœ 60MB+ã€‚

```bash
# è¿è¡Œå‹ç¼©è„šæœ¬
./scripts/compress_videos.sh

# å‹ç¼©å‚æ•°è¯´æ˜:
# - CRF 28 = å¹³è¡¡è´¨é‡å’Œå¤§å° (æ¨è)
# - ä½¿ç”¨å…¶ä»–è´¨é‡å€¼: ./scripts/compress_videos.sh <CRFå€¼>
#   CRF èŒƒå›´: 18-32 (å€¼è¶Šå°è´¨é‡è¶Šé«˜ï¼Œæ–‡ä»¶è¶Šå¤§)
```

### å‹ç¼©æ•ˆæœé¢„ä¼°
| åœºæ™¯ | åŸå§‹å¤§å° | å‹ç¼©å | èŠ‚çœ |
|------|---------|--------|------|
| å­¦æ ¡åœºæ™¯ | 37M | ~15M | ~59% |
| æ¶ˆé˜²ç«™ (4ä¸ª) | 51M | ~20M | ~61% |
| æ£®æ—åœºæ™¯ (2ä¸ª) | 19.6M | ~8M | ~59% |
| **æ€»è®¡** | **107M** | **~43M** | **~60%** |

---

## æ­¥éª¤ 5: æ„å»º Release APK

### ä½¿ç”¨æ„å»ºè„šæœ¬ (æ¨è)

```bash
./scripts/build_release.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨:
1. æ£€æŸ¥ç­¾åé…ç½®
2. æ¸…ç†ä¹‹å‰çš„æ„å»º
3. åˆ†æèµ„æºå¤§å°
4. æ„å»º Release APK
5. ç”Ÿæˆæ„å»ºæŠ¥å‘Š

### æ‰‹åŠ¨æ„å»º

```bash
# æ¸…ç†
./gradlew clean

# æ„å»º Release APK
./gradlew :composeApp:assembleRelease

# APK è¾“å‡ºä½ç½®
ls -lh composeApp/build/outputs/apk/release/
```

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶

æ„å»ºå®Œæˆåï¼ŒAPK æ–‡ä»¶ä½äº:

```
composeApp/build/outputs/apk/release/composeApp-release.apk
```

æ„å»ºæŠ¥å‘Šä½äº:

```
composeApp/build/outputs/apk/release/TigerFire-Release-Info.txt
```

---

## âœ… éªŒè¯ APK

### æ£€æŸ¥ APK ä¿¡æ¯
```bash
aapt dump badging composeApp/build/outputs/apk/release/composeApp-release.apk
```

### éªŒè¯ç­¾å
```bash
apksigner verify --print-certs composeApp/build/outputs/apk/release/composeApp-release.apk
```

### å®‰è£…æµ‹è¯•
```bash
# é€šè¿‡ USB å®‰è£…åˆ°è®¾å¤‡
adb install composeApp/build/outputs/apk/release/composeApp-release.apk

# æˆ–æ‰‹åŠ¨ä¼ è¾“åˆ°è®¾å¤‡å®‰è£…
```

---

## ğŸ“ å¤§å°ç›®æ ‡

| æ„å»ºç±»å‹ | é¢„è®¡å¤§å° | çŠ¶æ€ |
|---------|---------|------|
| Debug APK | ~120MB | - |
| Release APK (æœªå‹ç¼©è§†é¢‘) | ~110MB | å½“å‰ |
| Release APK (å‹ç¼©è§†é¢‘) | ~50MB | ç›®æ ‡ |
| App Bundle (AAB) | ~45MB | é•¿æœŸç›®æ ‡ |

---

## ğŸ”„ æ¢å¤åŸå§‹è§†é¢‘

å¦‚æœå‹ç¼©åè§†é¢‘æœ‰é—®é¢˜ï¼Œå¯ä»¥æ¢å¤:

```bash
# æ¢å¤å¤‡ä»½
cp -r composeApp/src/androidMain/assets/videos_backup/* \
     composeApp/src/androidMain/assets/videos/
```

---

## â— å¸¸è§é—®é¢˜

### Q: æ„å»ºå¤±è´¥æç¤ºæ‰¾ä¸åˆ° Keystore
**A**: æ£€æŸ¥ `keystore.properties` æ–‡ä»¶è·¯å¾„å’Œå†…å®¹æ˜¯å¦æ­£ç¡®

### Q: å‹ç¼©åè§†é¢‘æ— æ³•æ’­æ”¾
**A**: é™ä½ CRF å€¼æé«˜è´¨é‡ï¼Œæˆ–æ¢å¤åŸå§‹è§†é¢‘

### Q: APK å®‰è£…åé—ªé€€
**A**: æ£€æŸ¥ ProGuard è§„åˆ™ï¼Œå¯èƒ½éœ€è¦æ·»åŠ æ··æ·†ä¾‹å¤–

### Q: å¦‚ä½•å‡å° APK å¤§å°
**A**:
1. å‹ç¼©è§†é¢‘æ–‡ä»¶ (æ•ˆæœæœ€æ˜¾è‘—)
2. è½¬æ¢éŸ³é¢‘ä¸º AAC æ ¼å¼
3. è€ƒè™‘ä½¿ç”¨ App Bundle (AAB)
4. åŠ¨æ€ä¸‹è½½å¤§æ–‡ä»¶

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [APK ä¼˜åŒ–æŒ‡å—](./APK_OPTIMIZATION_GUIDE.md)
- [E2E æµ‹è¯•æŒ‡å—](./E2E_TEST_GUIDE.md)
- [é¡¹ç›® README](../README.md)

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½ Keystore**: ä¸¢å¤±åæ— æ³•æ›´æ–°åº”ç”¨
2. **å¯†ç å®‰å…¨**: ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 
3. **Git å¿½ç•¥**: `.gitignore` å·²é…ç½®å¿½ç•¥æ•æ„Ÿæ–‡ä»¶
4. **å›¢é˜Ÿå…±äº«**: å¦‚éœ€å›¢é˜Ÿå…±äº«ï¼Œä½¿ç”¨åŠ å¯†å­˜å‚¨

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥:
1. Java ç‰ˆæœ¬ (éœ€è¦ JDK 11+)
2. Android SDK ç‰ˆæœ¬
3. Gradle ç‰ˆæœ¬
4. ç½‘ç»œè¿æ¥ (é¦–æ¬¡æ„å»ºéœ€è¦ä¸‹è½½ä¾èµ–)
